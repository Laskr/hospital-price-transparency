project:
  name: "CMS Hospital Price Transparency Engine"
  version: "1.0.0"
  owner: "Portfolio Engineer"
  goal: "Ingest, Flatten, and Arbitrage Hospital Pricing Data (CMS v2.0 Schema)"

tech_stack:
  language: "Python 3.10+"
  ingestion: "Requests (Streaming) + Snowflake Connector"
  processing: "Snowflake (Variant Data Type) + dbt Core"
  visualization: "Streamlit"

data_sources:
  description: "CMS Compliant Machine Readable Files (MRF)"
  targets:
    - name: "Mayo_Clinic_Arizona"
      type: "JSON"
      url_pattern: "https://.../filenames-standard-charges.json"
    - name: "Banner_Health_Phoenix"
      type: "JSON"
      url_pattern: "https://.../filenames-standard-charges.json"

architecture:
  layer_1_raw_storage:
    platform: "Snowflake"
    database: "HOSPITAL_PRICE_RAW"
    schema: "INGESTION"
    table_structure:
      table_name: "RAW_JSON_DUMP"
      columns:
        - name: "HOSPITAL_NAME"
          type: "VARCHAR"
        - name: "LOAD_TIMESTAMP"
          type: "TIMESTAMP_NTZ"
        - name: "RAW_DATA"
          type: "VARIANT" # The "Secret Weapon" column

  layer_2_transformation:
    tool: "dbt Core"
    materialization: "Table/Incremental"
    models:
      - name: "stg_flattened_charges"
        description: "Initial explosion of JSON arrays using LATERAL FLATTEN"
      - name: "int_standardized_codes"
        description: "Normalization of CPT/DRG codes"
      - name: "marts_price_comparison"
        description: "Final analytical table for Streamlit consumption"

  layer_3_app:
    tool: "Streamlit"
    features:
      - "Procedure Search (Fuzzy Matching)"
      - "Payer Filter (Aetna, BCBS, UHC)"
      - "Arbitrage Calculation (Price Delta)"

data_schema_cms_v2:
  # Crucial keys we must parse from the JSON
  root_keys:
    - "hospital_name"
    - "last_updated_on"
  item_keys:
    - "description"
    - "code" (CPT/DRG)
  pricing_keys:
    - "standard_charge" (Gross)
    - "payer_specific_negotiated_charges" (The complex array)
